<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>管理员页面</title>
  <link rel="stylesheet" href="css/courseList.css" type="text/css">
  <link rel="stylesheet" href="css/common/bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="css/bootstrap-table.min.css" type="text/css">
  <link rel="stylesheet" href="css/bootstrap-select.min.css" type="text/css">
  <link rel="stylesheet" href="css/content/mynav.css" type="text/css">
  <link rel="stylesheet" href="css/fileinput.min.css" type="text/css">
  <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/bootstrap-table.min.js"></script>
  <script type="text/javascript" src="js/bootstrap-table-zh-CN.min.js"></script>
  <script type="text/javascript" src="js/bootstrap-select.min.js"></script>
  <script type="text/javascript" src="js/jquery.validate.min.js"></script>
  <script type="text/javascript" src="js/fileinput.min.js"></script>
  <script type="text/javascript" src="js/locales/zh.js"></script>
  <script type="text/javascript" src="js/jquery.validate.min.js"></script>
  <style type="text/css">
    .modal-backdrop,.in {
      height: 100vh;
      z-index: 2;
    }
    .modal {
      z-index: 3;
    }
    a.page-link {
      margin: 0;
    }
  </style>
</head>
<body>

  <!--导航栏-->
  <div class="adminNav">
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">课程管理 <span class="sr-only">(current)</span></a></li>
          <li><a href="#">学生管理</a></li>
          <li><a href="#">教师管理</a></li>
        </ul>

        <!--<form class="navbar-form navbar-left">-->
          <!--<div class="form-group">-->
            <!--<input type="text" class="form-control" placeholder="搜索">-->
          <!--</div>-->
          <!--<button type="submit" class="btn btn-default">查询</button>-->
        <!--</form>-->

        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">注销</a></li>
        </ul>

        <!--<form class="navbar-form navbar-right">-->
          <!--<button type="button" class="btn btn-default" id="addCourse">添加课程</button>-->
          <!--<select id="semester" class="selectpicker" title="请选择相应学期">-->
            <!--<option value="2019-2020-1">2019-2020-1</option>-->
            <!--<option value="2019-2020-1">2019-2020-2</option>-->
          <!--</select>-->
        <!--</form>-->

      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>
</div>

  <!--工具条-->
  <div id="toolbar">
    <button class="btn" id="btnAdd"><span class="glyphicon glyphicon-plus"></span> 新增</button>
    <button class="btn" id="btnEdit"><span class="glyphicon glyphicon-pencil"></span> 编辑</button>
    <button class="btn" id="btnDel"><span class="glyphicon glyphicon-remove"></span> 删除</button>
  </div>

  <!--课程表-->
  <div class="content">
    <div class="courseInfo">
      <table id="courseTable">
        <!--测试数据-->
        <!--<tr>-->
          <!--<td>1</td>-->
          <!--<td>大学物理</td>-->
          <!--<td>刘波</td>-->
          <!--<td>周一</td>-->
          <!--<td>教四</td>-->
          <!--<td>大一新生</td>-->
          <!--<td>100</td>-->
          <!--<td>32</td>-->
          <!--<td>4</td>-->
        <!--</tr>-->
      </table>
    </div>
  </div>

    <!--单独分页栏，现在已经不需要-->
    <!--<div class="navPage">-->
      <!--<nav aria-label="Page navigation">-->
        <!--<ul class="pagination">-->
          <!--<li>-->
            <!--<a href="#" aria-label="Previous">-->
              <!--<span aria-hidden="true">&laquo;</span>-->
            <!--</a>-->
          <!--</li>-->
          <!--<li><a href="#">1</a></li>-->
          <!--<li><a href="#">2</a></li>-->
          <!--<li><a href="#">3</a></li>-->
          <!--<li><a href="#">4</a></li>-->
          <!--<li><a href="#">5</a></li>-->
          <!--<li>-->
            <!--<a href="#" aria-label="Next">-->
              <!--<span aria-hidden="true">&raquo;</span>-->
            <!--</a>-->
          <!--</li>-->
        <!--</ul>-->
      <!--</nav>-->
    <!--</div>-->
  <!--</div>-->

  <!--添加课程模态窗口-->
  <!-- Modal -->
  <div class="modal fade" id="courseModal" tabindex="-1" role="dialog" aria-labelledby="添加课程">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">添加课程</h4>
        </div>
        <div class="modal-body">
          <!--添加课程信息-->
          <div class="container">
            <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
              <form name="courseInfo" id="courseInfo" method="post" enctype="multipart/form-data" action="" onsubmit="return datacheck();">

                <div class="form-group col-md-6 col-sm-6">
                  <label for="courseID" class="col-sm-4 control-label">课程编号</label>
                  <div class="col-sm-8">
                    <input type="text" name="courseID" class="form-control" id="courseID" placeholder="课程编号">
                  </div>
                </div>

                <div class="form-group col-md-6 col-sm-6">
                  <label for="courseName" class="col-sm-4 control-label">课程名称</label>
                  <div class="col-sm-8">
                    <input type="text" name="courseName" class="form-control" id="courseName" placeholder="课程名称">
                  </div>
                </div>

                <div class="form-group col-md-6 col-sm-6">
                  <label class="col-sm-4 control-label">授课老师</label>
                  <div class="col-sm-8">
                    <select class="form-control" name="courseTea" id="courseTea">
                      <option value="">请选择授课老师</option>
                      <option value="">还是直接用dropdownlist比较好</option>
                    </select>
                  </div>
                </div>

                <div class="form-group col-md-6 col-sm-6">
                  <label class="col-sm-4 control-label">院系编号</label>
                  <div class="col-sm-8">
                    <select class="form-control" name="courseInstitute" id="courseInstitute">
                      <option value="">请选择院系编号</option>
                      <option value="">还是直接用dropdownlist比较好</option>
                    </select>
                  </div>
                </div>


                <div class="form-group col-md-6 col-sm-6">
                  <label class="col-sm-4 control-label">课程学分</label>
                  <div class="col-sm-8">
                    <select class="form-control" name="courseCredit">
                      <option value="">请选择课程学分</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </div>
                </div>


                <div class="form-group col-md-6 col-sm-6 ">
                  <label class="col-sm-4 control-label">课程分类</label>
                  <div class="col-sm-8">
                    <select class="form-control" name="courseType">
                      <option value="必修课">必修课</option>
                      <option value="公选课">公选课</option>
                      <option value="专选课">专选课</option>
                    </select>
                  </div>
                </div>


                <div class="form-group col-md-6 col-sm-6">
                  <label for="courseMaxMun" class="col-sm-4 control-label">限选人数</label>
                  <div class="col-sm-8">
                    <input type="text" name="courseMaxMun" class="form-control" id="courseMaxMun" placeholder="限选人数">
                  </div>
                </div>


                <div class="form-group col-md-6 col-sm-6">
                  <label for="courseObj" class="col-sm-4 control-label">开课对象</label>
                  <div class="col-sm-8">
                    <input type="text" name="courseObj" id="courseObj" class="form-control" placeholder="开课对象">
                  </div>
                </div>


                <div class="form-group col-md-6 col-sm-6">
                  <label for="courseTime" class="col-sm-4 control-label">上课时间</label>
                  <div class="col-sm-8">
                    <input type="tel" name="courseTime" id="courseTime" required="required" class="form-control" placeholder="上课时间">
                  </div>
                </div>


                <div class="form-group col-md-6 col-sm-6">
                  <label for="coursePlace" class="col-sm-4 control-label">上课地点</label>
                  <div class="col-sm-8">
                    <input name="coursePlace" type="email" required="required" class="form-control" id="coursePlace" placeholder="上课地点">
                  </div>
                </div>


                <div class="form-group col-md-6 col-sm-6 hidden-xs">
                  <label for="courseTotalTime" class="col-sm-4 control-label">总课时长</label>
                  <div class="col-sm-8">
                    <input name="courseTotalTime" type="text" class="form-control" id="courseTotalTime" placeholder="总课时长">
                  </div>
                </div>


                <div class="form-group col-md-6 col-sm-6 ">
                  <label class="col-sm-4 control-label">课程学期</label>
                  <div class="col-sm-8">
                    <select class="form-control" name="courseType">
                      <option value="">请选择课程学期</option>
                      <option value="2019-2020-1">2019-2020-1</option>
                      <option value="2019-2020-2">2019-2020-2</option>
                      <option value=""></option>
                    </select>
                  </div>
                </div>

                <div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <label for="courseTotalTime" class="col-sm-2 control-label">课程图片</label>
                  <div class="col-sm-10">
                    <input name="courseImg" type="file" class="form-control file-loading" id="courseImg" placeholder="课程图片">
                  </div>
                </div>

                <div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <label for="courseIntro" class="col-sm-2 control-label">课程简介</label>
                  <div class="col-sm-10">
                    <textarea class="form-control" rows="3" name="courseIntro" id="courseIntro" required="required"></textarea>
                  </div>
                </div>


                <div class="form-group">
                  <div class="col-sm-6">
                    <button type="submit" name="submit" class="btn btn-primary pull-right">提交</button>
                  </div>
                  <div class="col-sm-6">
                    <button name="reset" type="reset" class="btn btn-default pull-left">重置</button>
                  </div>
                </div>

              </form>
          </div>
          </div>

        </div>
        <!--<div class="modal-footer">-->
          <!--&lt;!&ndash;<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>&ndash;&gt;-->
          <!--&lt;!&ndash;<button type="button" class="btn btn-primary">保存</button>&ndash;&gt;-->
        <!--</div>-->
      </div>
    </div>
  </div>



  <script type="text/javascript">

  $(function () {
    $('#courseTable').bootstrapTable({
      url: '',
      toolbar: '#toolbar',
      cache: false,
      pagination: true,
      pageSize: 10,
      pageList: [10, 15, 20, 50],
      sortable: true,
      singleSelect: true,
      clickToSelect: true,
      search: true,
      showRefresh: true,
      showColumns: true,
      onClickRow:function (row,$element) {
        $('.info').removeClass('info');
        $($element).addClass('info');
      },
      columns: [{
        field: 'courseID',
        title: '课程号',
        sortable: true,
      }, {
        field: 'courseName',
        title: '课程名'
      }, {
        field: 'courseTea',
        title: '授课老师'
      }, {
        field: 'courseTime',
        title: '上课时间'
      }, {
        field: 'coursePlace',
        title: '上课地点'
      },{
        field: 'courseObj',
        title: '开课对象'
      },{
        field: 'courseMaxNum',
        title: '限制人数',
        sortable: true,
      },{
        field: 'courseTotalTime',
        title: '课时',
        sortable: true,
      },{
        field: 'courseCredit',
        title: '学分',
        sortable: true,
      }]

    });


    $('.fixed-table-toolbar').append(`
    <div class="columns columns-right pull-right" style="padding: 0 5px">
    <select id="semester" class="selectpicker" title="请选择相应学期">
            <option value="2019-2020-1">2019-2020-1</option>
            <option value="2019-2020-1">2019-2020-2</option>
          </select>
    </div>
    `)


    $('#btnAdd').click(function () {
      $('#courseModal').modal({
        backdrop:'static'
      })
      $('.modal input').val('')
    })

    // 这个修改只能得到表格里面的信息，图片和简介没有，需要写ajax
    $('#btnEdit').click(function () {
      let list = getRowContent()
      $('#courseModal').modal({
        backdrop:'static'
      })
      setModalVal(list)
    })

    $('#btnDel').click(function () {
      let $table = $('#courseTable')
      let list = getRowContent()
      let id =[];
      id.push(list['courseID']);
      $table.bootstrapTable('remove', {
        field:'courseID',
        values: id
      });

    })


    $('#courseImg').fileinput({
      language: 'zh',
      showPreview : false,
      dropZoneEnabled: false
    })


    // 获取选中行对象
    function getRowContent(){
      let $table = $('#courseTable')
      let index = $table.find("tr.info").data("index")
      let list = $table.bootstrapTable('getData')[index]
      if(list == null){
        alert("请选中一行");
        return false;
      }else{
        console.log(list)
        return list
      }
    }

    // 给模态窗口赋值，只能获取表格里面的数据，完整信息需要写ajax
    function setModalVal(obj) {
      $('#courseID').val(obj.courseID)
      $('#courseName').val(obj.courseName)
      $('#courseTea').val(obj.courseTea)
      $('#courseTime').val(obj.courseTime)
      $('#coursePlace').val(obj.coursePlace)
      $('#courseObj').val(obj.courseObj)
      $('#courseMaxNum').val(obj.courseMaxNum)
      $('#courseTotalTime').val(obj.courseTotalTime)
      $('#courseCredit').val(obj.courseCredit)
    }

    //模态表单提交正则
    $.validator.setDefaults( {
      submitHandler: function () {
        form.submit();
      }
    } );


    $( "#courseInfo" ).validate( {
      rules: {
        courseID: {
          required: true,
        },
        courseName: {
          required: true,
        },
        courseTea: {
          required: true,
        },
        courseTime: {
          required: true
        },
        coursePlace: {
          required: true
        },
        courseObj: {
          required: true
        },
        courseMaxNum: {
          required: true,
          digits:true,
          range:[30, 200]
        },
        courseTotalTime: {
          required: true
        },
        courseCredit: {
          required: true
        }

      },
      messages: {
        courseID: {
          required: "请输入课程号",
        },
        courseName: {
          required: "请输入课程名",
        },
        courseTea: {
          required: "请输入授课教师"
        },
        courseTime: {
          required: "请输入上课时间"
        },
        coursePlace: {
          required: "请输入上课地点"
        },
        courseObj: {
          required: "请输入上课对象"
        },
        courseMaxNum: {
          required: "请输入最大限选人数",
          digits: "请输入整数",
          range: "数据范围为30-200"
        },
        courseTotalTime: {
          required: "请输入课程总课时"
        },
        courseCredit: {
          required: "请输入课程学分"
        },
      },
      errorElement: "em",
      errorPlacement: function ( error, element ) {
        // Add the `help-block` class to the error element
        error.addClass( "help-block" );

        if ( element.prop( "type" ) === "checkbox" ) {
          error.insertAfter( element.parent( "label" ) );
        } else {
          error.insertAfter( element );
        }
      },
      highlight: function ( element, errorClass, validClass ) {
        $( element ).parents( ".form-group" ).addClass( "has-error" ).removeClass( "has-success" );
      },
      unhighlight: function (element, errorClass, validClass) {
        $( element ).parents( ".form-group" ).addClass( "has-success" ).removeClass( "has-error" );
      }
    } );


    // $.validator.addMethod("checkCourseTime",function(value,element,params){
    //   let checkCourseTime = //;
    //   return this.optional(element)||(checkCourseTime.test(value));
    // },"*请输入正确的课程时间！")
    //
    //
    // $.validator.addMethod("checkCoursePlace",function(value,element,params){
    //   let checkCoursePlace = //;
    //   return this.optional(element)||(checkCoursePlace.test(value));
    // },"*请输入正确的课程地点！")



  })

  </script>
</body>
</html>